---
title: "scRNA-seq Downstream Analysis"
output: rmarkdown::html_vignette
vignette: >
  %/VignetteIndexEntry{scRNA-seq Downstream Analysis}
  %/VignetteEngine{knitr::rmarkdown}
  %/VignetteEncoding{UTF-8}
---

```{r setup}
# Load packages
library(Seurat)
library(SeuratObject)
library(cowplot)
library(dplyr)
library(ggplot2)
library(stringr)
library(sqldf)
library(ggpubr)
library(EnhancedVolcano)
library(corrplot)

# Source shared utility functions
source("utils.R")

# ──────────────────────────────────────────────────────────────
# USER-CONFIGURABLE PATHS
# Update these paths to match your local environment.
# ──────────────────────────────────────────────────────────────
study <- paste0("D:/GoogleDrive/spatial_leishmania/spatial/SingleCellAnalysis/mouse/shoumit/scRNA_30032021/SD2105/SC_re_run/")
repeat_study <- paste0("D:/GoogleDrive/spatial_leishmania/spatial/SingleCellAnalysis/mouse/shoumit/scRNA_27052021/SD2705/")
output_integrated <- paste0("D:/GoogleDrive/spatial_leishmania/spatial/_EXPERIMENTS/SD22.8.4_MM2105_SD2705_scRNA_re_analysis/R/")

# Set PCA dimensions and resolution for cluster identification
dims <- 15
res <- 0.4

# Load reactome genes
reactome_lipids <- read.csv(
  paste0("D:/GoogleDrive/spatial_leishmania/spatial/_EXPERIMENTS/SD22.5.1_YMP_day28pi/R/woI4/REACTOME_METABOLISM_OF_LIPIDSv2023.1.Mm.csv"),
  header = FALSE, col.names = "gene"
)
```

```{r start_here_if_already_integrated}
input_string <- paste0(output_integrated, "integrated_sd2705_", "dims", dims, "_res", res, ".rds")
print(paste0("Reading file:", input_string))
seuratObj <- readRDS(input_string)
rm(input_string)

table(seuratObj@meta.data$INF)
table(seuratObj@meta.data$orig.ident)

seuratObj <- SetIdent(seuratObj, value = "CellTypeM")
```

```{r visualise_cells_in_low_dim}
# Visualise phenotypes in low dimensional space
DimPlot(seuratObj, label = TRUE, label.box = TRUE) + NoLegend()
DimPlot(seuratObj, reduction = "pca", label = TRUE, label.box = TRUE) + NoLegend()
DimPlot(seuratObj, reduction = "pca", label = TRUE, label.box = TRUE, group.by = "CellMeshFine") + NoLegend()
DimPlot(seuratObj, label = TRUE, label.box = TRUE) + NoLegend()

pdf(paste0(output_integrated, "/phenotyping/", "integrated_sd2705_", "dims", dims, "_res", res, ".pdf"))
  DimPlot(seuratObj, label = TRUE, label.box = FALSE, group.by = "CellMeshFine", label.size = 4) + NoLegend()
dev.off()

pdf(paste0(output_integrated, "/phenotyping/", "integrated_sd2705_tsne_", "dims", dims, "_res", res, ".pdf"))
  DimPlot(seuratObj, reduction = "tsne", label = TRUE, label.box = TRUE) + NoLegend()
  DimPlot(seuratObj, reduction = "tsne", label = TRUE, label.box = TRUE, group.by = "CellMeshFine", label.size = 4) + NoLegend()
dev.off()


# Visualise cluster memberships per group
# Remove RBCs and hepatocytes
reduced_seuratObj <- subset(seuratObj, subset = CellTypeM %in% c("RBCs", "Hepatocytes"), invert = TRUE)
reduced_seuratObj@meta.data$CellMeshFine <- droplevels(reduced_seuratObj@meta.data$CellMeshFine)

# Fetch Seurat cluster colours
p <- DimPlot(reduced_seuratObj, group.by = "CellMeshFine")
pbuild <- ggplot2::ggplot_build(p)
pdata <- pbuild$data[[1]]
pdata <- pdata[order(pdata$group), ]
ucols <- unique(pdata$colour)
names(ucols) <- unique(pdata$group)

cells_prop_by_cluster <- prop.table(table(reduced_seuratObj$CellMeshFine, reduced_seuratObj$orig.ident), margin = 2)
cells_prop_by_cluster

pdf(paste0(output_integrated, "/phenotyping/", "ident_prop_bar_fig2b.pdf"), height = 5, width = 5)
  barplot(cells_prop_by_cluster, col = ucols, border = "white", space = 0.04, font.axis = 2)
dev.off()

pdf(paste0(output_integrated, "/phenotyping/", "For_CellMeshFine_Legends.pdf"), height = 10, width = 6)
  p
dev.off()

# Write proportion per cell type and orig.ident
write.csv(
  prop.table(table(reduced_seuratObj$CellMeshFine, reduced_seuratObj$orig.ident), margin = 2),
  paste0(output_integrated, "/phenotyping/", "_ident_proportions_sample_no_hepato_noRBCs.csv"),
  row.names = TRUE
)

top_features <- c("Maf", "Ifng", "Igkc", "Ighm", "Lyz2", "Saa3", "Fabp1", "Apoc1", "Gzma", "Ccl5", "Car3", "Gsta3", "Hmgb2", "Hist1h2ap", "Malat1", "Xist", "Cx3cr1", "Nkg7", "Tmsb4x", "AW112010", "Il7r", "Lef1", "Apoe", "C1qa", "Hba-a2", "Hba-a1", "S100a9", "S100a8", "Cst3", "H2-Ab1", "Car2", "Hbb-bt", "Prtn3", "Mpo", "Tnfrsf4", "Ctla4", "Bst2", "Siglech", "Ccl3", "Mcpt8")

pdf(paste0(output_integrated, "/phenotyping/", "top_markers_integrated_sd2705_", "dims", dims, "_res", res, ".pdf"), width = 13)
  DotPlot(seuratObj, features = top_features, group.by = "CellMeshFine") + RotatedAxis()
dev.off()

pdf(paste0(output_integrated, "/phenotyping/inflamm_", "dims", dims, "_res", res, ".pdf"), width = 7, height = 6)
  DotPlot(seuratObj, features = c("Ifng", "Tnf", "Nos2", "Il10", "Il4", "Tgfb1", "Tgfb2", "Tgfb3"), group.by = "CellMeshFine") + RotatedAxis()
dev.off()

pdf(paste0(output_integrated, "/phenotyping/macrophages_canonical.pdf"), width = 3, height = 6)
  Idents(seuratObj) <- "CellMeshFine"
  DotPlot(seuratObj, features = c("Adgre1", "Clec4f", "Marco", "Ccr2", "Ly6c2", "Itgam", "Itgax")) + RotatedAxis() + xlab(label = "") + ylab(label = "") + NoLegend()
dev.off()

myeloid_cell_types <- c("ApoeHI_Kupffer", "Lyz2hi_MoMac", "Neutrophils", "APCs", "Neutrophils/Mono", "Mast", "pre-cDCs")

pdf(paste0(output_integrated, "/phenotyping/macrophages_activation_dot.pdf"), width = 4, height = 3)
  Idents(seuratObj) <- "CellMeshFine"
  DotPlot(seuratObj, features = c("Tnf", "Nos2", "Il6", "Cxcl9", "Il10", "Tlr2", "Cd86"), idents = myeloid_cell_types) + xlab(label = "") + ylab(label = "") + NoLegend()
dev.off()

pdf(paste0(output_integrated, "/phenotyping/macrophages_activation_vln.pdf"), width = 4, height = 3)
  Idents(seuratObj) <- "CellMeshFine"
  VlnPlot(seuratObj, features = c("Tnf", "Nos2", "Il6", "Cxcl9", "Il10", "Tlr2", "Cd86"), stack = TRUE, idents = myeloid_cell_types) + xlab(label = "") + ylab(label = "") + NoLegend()
dev.off()
```

```{r volcano_plot_comparing_macrophages}
Idents(seuratObj) <- "CellMeshFine"
infected_cells_only <- subset(seuratObj, subset = INF == "infected")
kupfferVsMoMacs <- FindMarkers(infected_cells_only, ident.1 = "ApoeHI_Kupffer", ident.2 = "Lyz2hi_MoMac", test.use = "MAST", assay = "RNA")

# Save marker genes
write.csv(kupfferVsMoMacs, paste0(output_integrated, "/phenotyping/kupfferVsMoMacsIn_Infection.csv"), row.names = TRUE)

# Read marker genes
kupfferVsMoMacs <- read.csv(paste0(output_integrated, "/phenotyping/kupfferVsMoMacsIn_Infection.csv"), header = TRUE)

# Prepare data for volcano plot
df <- kupfferVsMoMacs
df$p_val <- NULL
colnames(df) <- c("gene", "log2FoldChange", "pct1", "pct2", "pvalue")
df$pvalue[df$pvalue == 0] <- 5e-305
rownames(df) <- df$gene

# Plotting Figure 2E
pdf(paste0(output_integrated, "/phenotyping/Fig2E.pdf"), height = 5, width = 8)
  print(EnhancedVolcano(df,
    lab = rownames(df),
    x = 'log2FoldChange',
    xlim = c(-3.3, 5.3),
    ylim = c(0, 350),
    y = 'pvalue',
    title = "kupfferVsMoMacs",
    pCutoff = 10e-5,
    FCcutoff = 2,
    pointSize = 1,
    labSize = 5,
    subtitle = "",
    drawConnectors = TRUE,
    widthConnectors = 0.25))
dev.off()
```

```{r figure3_lpcat2_remodelling}
# FIGURE 3: LPCAT2 phospholipid remodelling analysis
acyl_chain_remodelling_genes <- c("Lpcat1", "Lpcat2", "Lpcat3", "Lpcat4", "Mboat2", "Pla2g10", "Pla2g12a", "Pla2g1b", "Pla2g2a", "Pla2g2d", "Pla2g2e", "Pla2g2f", "Pla2g3", "Pla2g4a", "Pla2g4b", "Pla2g4c", "Pla2g4d", "Pla2g4e", "Pla2g4f", "Pla2g5", "Pla2g6", "Pla2r1", "Plaat3", "Plb1", "Plbd1", "Pnpla8", "Tmem86b", "Pla2g15", "Pla2g7")
lpcat2_remodelling <- c("Lpcat2", "Pla2g4a", "Pla2g15", "Pla2g7")
cytokines <- c("Tnf", "Nos2", "Il6", "Il1b", "Cd86", "Tlr2")
anti_inflamm_cytokines <- c("Il10", "Tgfb1", "Arg1", "Il4")

seuratObj_woRBCs <- subset(seuratObj, subset = CellTypeM %in% c("RBCs", "Hepatocytes"), invert = TRUE)
seuratObj_woRBCs <- AddModuleScore(seuratObj_woRBCs, features = list(acyl_chain_remodelling_genes), name = "PC_remodelling_score")
seuratObj_woRBCs <- AddModuleScore(seuratObj_woRBCs, features = list(cytokines), name = "Kill_score")
seuratObj_woRBCs <- AddModuleScore(seuratObj_woRBCs, features = list(anti_inflamm_cytokines), name = "Anti_inflamm_score")
seuratObj_woRBCs <- AddModuleScore(seuratObj_woRBCs, features = list(lpcat2_remodelling), name = "LPCAT2_remodelling_score")

# Histogram of LPCAT2 remodelling score
data <- seuratObj_woRBCs$LPCAT2_remodelling_score1
pdf(paste0(output_integrated, "LPCAT2_remodelling_score_histogram.pdf"), width = 10, height = 7)
  valley_point <- plot_with_valley(data, "LPCAT2-Phospholipid Re-modelling Score")
dev.off()

if (!is.null(valley_point)) {
  cat("Valley point between highest peaks:", round(valley_point, 2), "\n")
}

pdf(paste0(output_integrated, "acyl_chain_remodelling_in_single_cells_wHepatocytes.pdf"), height = 5, width = 7)
  DotPlot(seuratObj, assay = "SCT", features = acyl_chain_remodelling_genes, group.by = "CellMeshFine") + RotatedAxis() + ylab(label = "") + xlab(label = "")
dev.off()

pdf(paste0(output_integrated, "acyl_chain_remodelling_in_single_cells.pdf"), height = 5, width = 7)
  DotPlot(seuratObj_woRBCs, assay = "SCT", features = acyl_chain_remodelling_genes, group.by = "CellMeshFine") + RotatedAxis() + ylab(label = "") + xlab(label = "")
  VlnPlot(seuratObj_woRBCs, features = c("PC_remodelling_score1"), group.by = "CellMeshFine", cols = c(rep("grey", 18))) + NoLegend()
  VlnPlot(seuratObj_woRBCs, features = c("Lpcat2"), group.by = "CellMeshFine", cols = c(rep("grey", 18))) + NoLegend()
  VlnPlot(seuratObj_woRBCs, features = c("LPCAT2_remodelling_score1"), group.by = "CellMeshFine", cols = c(rep("grey", 18))) + NoLegend() + geom_hline(yintercept = round(valley_point, 2), color = "maroon", linetype = "dashed")
  VlnPlot(seuratObj_woRBCs, features = c("Kill_score1"), group.by = "CellMeshFine", cols = c(rep("grey", 18))) + NoLegend()
dev.off()

# LPCAT2 remodelling: myeloid cells high/low analysis
myeloid_only_woRBCs <- subset(seuratObj_woRBCs, subset = CellMeshFine %in% c("ApoeHI_Kupffer", "Lyz2hi_MoMac", "Neutrophils"))
myeloid_only_woRBCs$LPCAT2_remodelling_score_HiLo <- "low"
myeloid_only_woRBCs$LPCAT2_remodelling_score_HiLo[myeloid_only_woRBCs$LPCAT2_remodelling_score1 >= 0.2] <- "high"
myeloid_only_woRBCs@meta.data$CellMeshFine <- droplevels(myeloid_only_woRBCs@meta.data$CellMeshFine)
split_hi_lo <- data.frame(table(myeloid_only_woRBCs$LPCAT2_remodelling_score_HiLo, myeloid_only_woRBCs$CellMeshFine))

# Correlation between LPCAT2 remodelling and activation by cell type
pro_inflamm_genes <- "Score based on: Tnf, Nos2, Il6, Il1b, Cd86, Tlr2"
anti_inflamm_genes <- "Score based on: Il10, Tgfb1, Arg1, Il4"
cell_types <- unique(myeloid_only_woRBCs$CellMeshFine)
plots_list <- list()

for (cell in cell_types) {
  cell_data <- subset(myeloid_only_woRBCs, CellMeshFine == cell)

  pro_cor <- cor.test(cell_data$LPCAT2_remodelling_score1, cell_data$Kill_score1, method = "spearman")
  anti_cor <- cor.test(cell_data$LPCAT2_remodelling_score1, cell_data$Anti_inflamm_score1, method = "spearman")

  kill <- FeatureScatter(cell_data, feature1 = "LPCAT2_remodelling_score1", feature2 = "Kill_score1") +
    NoLegend() +
    geom_point(color = "grey") +
    labs(x = "LPCAT2 remodelling score", y = "Pro-inflamm. score") +
    annotate("text", x = min(cell_data$LPCAT2_remodelling_score1),
             y = max(cell_data$Kill_score1),
             label = paste0(pro_inflamm_genes, " for ", cell),
             hjust = 0, vjust = 1, size = 3) +
    annotate("text", x = max(cell_data$LPCAT2_remodelling_score1),
             y = min(cell_data$Kill_score1),
             label = sprintf("rho = %.2f\np = %.2e", pro_cor$estimate, pro_cor$p.value),
             hjust = 1, vjust = 0, size = 3)

  anti_inflamm <- FeatureScatter(cell_data, feature1 = "LPCAT2_remodelling_score1", feature2 = "Anti_inflamm_score1") +
    NoLegend() +
    geom_point(color = "grey") +
    labs(x = "LPCAT2 remodelling score", y = "Anti-inflamm. score") +
    annotate("text", x = min(cell_data$LPCAT2_remodelling_score1),
             y = max(cell_data$Anti_inflamm_score1),
             label = paste0(anti_inflamm_genes, " for ", cell),
             hjust = 0, vjust = 1, size = 3) +
    annotate("text", x = max(cell_data$LPCAT2_remodelling_score1),
             y = min(cell_data$Anti_inflamm_score1),
             label = sprintf("rho = %.2f\np = %.2e", anti_cor$estimate, anti_cor$p.value),
             hjust = 1, vjust = 0, size = 3)

  combined <- kill + anti_inflamm
  plots_list[[cell]] <- combined

  inflamm_data <- cell_data@meta.data[, c("LPCAT2_remodelling_score1", "Anti_inflamm_score1", "Kill_score1")]
  inflamm_data_corr <- cor(inflamm_data, method = "spearman")
  print(paste0("Running correlations for - ", cell))
  print(inflamm_data_corr)
  inflamm_data_p <- cor.mtest(inflamm_data)$p
  print(inflamm_data_p)
  print("--------------------------------------")

  pdf(paste0(output_integrated, cell, "inflamm_anti_inflamm_correlations.pdf"), height = 6, width = 6)
    print(corrplot(inflamm_data_corr,
      type = "upper",
      p.mat = inflamm_data_p,
      sig.level = 0.05,
      insig = "blank",
      tl.col = "black",
      col = colorRampPalette(c("navy", "white", "firebrick3"))(100)))
  dev.off()
}

pdf(paste0(output_integrated, "LPCAT2_remodelling_correlation_activation_by_celltype.pdf"), height = 12, width = 8)
  patchwork::wrap_plots(plots_list, ncol = 1)
dev.off()

pdf(paste0(output_integrated, "LPCAT2_remodelling_score_HiLo_cell_counts.pdf"), height = 5, width = 3)
  ggplot(split_hi_lo, aes(x = Var2, y = Freq, fill = Var1)) +
    geom_bar(stat = "identity", position = "dodge") +
    labs(title = "", x = "Cell Type", y = "Count") +
    theme_minimal() +
    scale_fill_manual(values = c("high" = "maroon", "low" = "grey")) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank())
dev.off()

pdf(paste0(output_integrated, "LPCAT2_remodelling_score_infection_versus_naive.pdf"), height = 5, width = 3)
  VlnPlot(myeloid_only_woRBCs, features = "LPCAT2_remodelling_score1", group.by = "INF", cols = c("grey", "grey")) + geom_hline(yintercept = 0.2)
dev.off()

# Find markers: LPCAT2 remodelling high vs low
myeloid_only_woRBCs <- SetIdent(myeloid_only_woRBCs, value = "LPCAT2_remodelling_score_HiLo")
lpcat2_remodelling_hi <- FindMarkers(myeloid_only_woRBCs, ident.1 = "high", ident.2 = "low", test.use = "MAST", assay = "RNA")
write.csv(lpcat2_remodelling_hi, paste0(output_integrated, "/phenotyping/lpcat2_remodelling_hi_myeloid.csv"), row.names = TRUE)

lpcat2_remodelling_hi <- read.csv(paste0(output_integrated, "/phenotyping/lpcat2_remodelling_hi_myeloid.csv"), header = TRUE)
df <- lpcat2_remodelling_hi
df$p_val <- NULL
colnames(df) <- c("gene", "log2FoldChange", "pct1", "pct2", "pvalue")
df$pvalue[df$pvalue == 0] <- 5e-305
rownames(df) <- df$gene

# Plotting Figure 3H
pdf(paste0(output_integrated, "/phenotyping/Fig3H.pdf"), height = 13, width = 8)
  print(EnhancedVolcano(df,
    lab = rownames(df),
    x = 'log2FoldChange',
    xlim = c(-4.3, 2.2),
    ylim = c(0, 400),
    y = 'pvalue',
    title = "lpcat2_remodelling_hi",
    pCutoff = 10e-5,
    FCcutoff = 1.0,
    pointSize = 1,
    labSize = 5,
    subtitle = "",
    drawConnectors = TRUE,
    widthConnectors = 0.25))
dev.off()
```

```{r figure4_lipid_intersection}
# FIGURE 4: Lipid gene intersection analysis
lipid_intersection_insubs <- read.csv(
  paste0("D:/GoogleDrive/spatial_leishmania/spatial/_EXPERIMENTS/SD22.5.1_YMP_day28pi/R/woI4/reactome_intersection_genes_Sub01236.csv"),
  header = TRUE
)

pdf(paste0(output_integrated, "reactome_intersection_genes_Sub01236_in_single_cells.pdf"), height = 4, width = 9)
  DotPlot(seuratObj, assay = "SCT", features = sort(lipid_intersection_insubs$Intersect), group.by = "CellMeshFine") + RotatedAxis() + ylab(label = "") + xlab(label = "")
dev.off()

# Subset: remove parenchyma and blood cells
seuratObj <- subset(seuratObj, idents = c("RBCs", "Hepatocytes"), invert = TRUE)
seuratObj$CellTypeM <- droplevels(seuratObj$CellTypeM)
table(seuratObj$CellTypeM)

celltypes <- c("T cells", "B cells", "Macrophages", "Prolif. cells", "Stem-like", "NK cells", "Neutrophils", "Neutrophils/Mono", "Mast")
Idents(seuratObj) <- factor(x = Idents(seuratObj), levels = celltypes)
cell_colours <- c("#CD9600", "#E68613", "#00BE67", "#00C19A", "#00BFC4", "#00B8E7", "#00A9FF", "#8494FF", "#ABA300")

DimPlot(seuratObj, reduction = "pca", label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()
DimPlot(seuratObj, label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()
DimPlot(seuratObj, reduction = "tsne", label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()

pdf(paste0(output_integrated, "/low_dim_visual/", "integrated_sd2705_", "dims", dims, "_res", res, ".pdf"))
  DimPlot(seuratObj, reduction = "pca", label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()
  DimPlot(seuratObj, label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()
  DimPlot(seuratObj, reduction = "tsne", label = TRUE, label.box = TRUE, cols = cell_colours) + NoLegend()
dev.off()

Idents(seuratObj) <- "INF"
small_Seurat <- subset(seuratObj, downsample = 3500)
Idents(seuratObj) <- "CellTypeM"
Idents(small_Seurat) <- "CellTypeM"
```

```{r prepare_for_correlation}
# Subset myeloid cells for correlation analysis
test_obj_str <- "myeloid_only_woRBCs"
test_obj <- list()
test_obj[[test_obj_str]] <- myeloid_only_woRBCs
```

```{r correlations, warning=FALSE}
gene_name <- "Lpcat2"

ptm <- proc.time()
list_corr_mat <- fn_get_corr_mat(test_obj[[test_obj_str]], gene_name)
time_taken <- proc.time() - ptm

print(paste0("Time elapsed: ", sprintf((time_taken[3] / 60), fmt = '%#.2f'), " minutes"))

head(list_corr_mat[[paste0("corr_", gene_name)]], 20)
head(list_corr_mat[[paste0("acorr_", gene_name)]], 20)

write.table(list_corr_mat[[paste0("corr_", gene_name)]],
            file = paste0(output_integrated, "corr_", test_obj_str, "_", gene_name, ".csv"),
            sep = ",", row.names = FALSE)

write.table(list_corr_mat[[paste0("acorr_", gene_name)]],
            file = paste0(output_integrated, "acorr_", test_obj_str, "_", gene_name, ".csv"),
            sep = ",", row.names = FALSE)

rm(list_corr_mat)
```

```{r plot_myeloid_lpcat2_corr}
test_obj_str <- "myeloid_only_woRBCs"
lpcat2_corr <- read.csv(paste0(output_integrated, "corr_", test_obj_str, "_", gene_name, ".csv"), header = TRUE)

# Select genes with correlation > 95th percentile
lpcat2_corr <- lpcat2_corr[lpcat2_corr$corr_estimate > quantile(lpcat2_corr$corr_estimate, 0.95), ]
lpcat2_corr <- lpcat2_corr[order(-lpcat2_corr$corr_estimate), ]
lpcat2_corr$gene <- factor(lpcat2_corr$gene, levels = lpcat2_corr$gene)
lpcat2_corr <- lpcat2_corr[lpcat2_corr$gene != gene_name, ]

pdf(paste0(output_integrated, "/", "lpcat2_corr_bar_", test_obj_str, "_Fig2.pdf"), width = 2, height = 4)
  ggplot(lpcat2_corr, aes(x = gene, y = corr_estimate)) +
    geom_bar(stat = "identity", fill = "#4299E1") +
    coord_flip() +
    theme_minimal() +
    labs(
      title = "Lpcat2 correlated genes - top 5%",
      x = "",
      y = "Correlation (Spearman's)"
    )
dev.off()
```
